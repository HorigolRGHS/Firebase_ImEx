# Firestore Import/Export Project

This project provides Node.js scripts to manage Firestore data by exporting collections and subcollections to JSON files and importing them back into Firestore. Additionally, it includes a script to export the entire database structure into a single, pretty-printed JSON file for easy visualization of the hierarchy.

## Table of Contents
- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Folder Structure](#folder-structure)
- [Scripts](#scripts)
  - [export.js](#exportjs)
  - [import.js](#importjs)
  - [structure.js](#structurejs)
- [Usage](#usage)
- [Output Formats](#output-formats)
- [Notes](#notes)

## Overview
The project includes three main scripts:
- **`export.js`**: Exports all Firestore collections and subcollections to a hierarchical folder structure with JSON files.
- **`import.js`**: Imports JSON files from the folder structure back into Firestore, maintaining the same hierarchy and deleting any documents/collections not present in the input.
- **`structure.js`**: Exports the entire Firestore database structure into a single, pretty-printed JSON file, representing collections and documents as nested arrays for clarity.

## Prerequisites
- **Node.js**: Version 12 or higher.
- **Firebase Admin SDK**: Required for interacting with Firestore.
- **Firestore Database**: A Firebase project with Firestore enabled.
- **Service Account Key**: A JSON key file (`a.json`) for Firebase Admin SDK authentication.

## Installation
1. Clone or download this project to your local machine.
2. Install dependencies:
   ```bash
   npm install firebase-admin
   ```
3. Place your Firebase service account key (`a.json`) in the project root directory.
4. Ensure your Firestore database is accessible with the provided credentials.

## Folder Structure
- **`collections/`**: Stores JSON files exported by `export.js` and read by `import.js`. Each collection is a JSON file, and subcollections are stored in subfolders.
- **`exported_structure/`**: Stores the single `db_structure.json` file generated by `structure.js`.
- **`a.json`**: Firebase service account key (not included; you must provide this).
- **`export.js`**, **`import.js`**, **`structure.js`**: The main scripts.

## Scripts

### export.js
Exports all Firestore collections and subcollections to the `collections/` folder. Each collection is saved as a JSON file, and subcollections are stored in subfolders named after their parent document.

- **Input**: Firestore database.
- **Output**: JSON files in `collections/` (e.g., `collections/users.json`, `collections/users/user1/orders.json`).
- **Command**:
  ```bash
  node export.js
  ```

### import.js
Imports JSON files from the `collections/` folder into Firestore, recreating the hierarchy. It deletes existing collections/documents in Firestore that are not present in the input JSON files.

- **Input**: JSON files in `collections/`.
- **Output**: Updates Firestore database to match the JSON structure.
- **Command**:
  ```bash
  node import.js
  ```

### structure.js
Exports the entire Firestore database structure into a single, pretty-printed JSON file (`db_structure.json`) in the `exported_structure/` folder. Collections are represented as keys, with documents as arrays of objects (including an `id` field) and subcollections nested within their parent documents.

- **Input**: Firestore database.
- **Output**: `exported_structure/db_structure.json`.
- **Command**:
  ```bash
  node structure.js
  ```

## Usage
1. **Export Data**:
   Run `export.js` to save all Firestore data to `collections/`:
   ```bash
   node export.js
   ```
2. **Import Data**:
   Modify JSON files in `collections/` as needed, then run `import.js` to sync them to Firestore:
   ```bash
   node import.js
   ```
3. **View Database Structure**:
   Run `structure.js` to generate a single JSON file showing the database hierarchy:
   ```bash
   node structure.js
   ```

## Output Formats

### export.js
Creates a folder structure in `collections/`:
- Top-level collection: `collections/<collection>.json`
- Subcollection: `collections/<collection>/<docId>/<subcollection>.json`
- Example:
  ```json
  // collections/users.json
  [
    { "id": "user1", "name": "John" }
  ]
  // collections/users/user1/orders.json
  [
    { "id": "order123", "item": "Book" }
  ]
  ```

### import.js
Reads the `collections/` folder and updates Firestore to match the JSON structure, deleting any extra documents/collections.

### structure.js
Produces a single `db_structure.json` file in `exported_structure/`:
```json
{
  "users": [
    {
      "id": "user1",
      "name": "John",
      "orders": [
        {
          "id": "order123",
          "item": "Book"
        }
      ]
    }
  ],
  "products": [
    {
      "id": "prod1",
      "name": "Laptop"
    }
  ]
}
```

## Notes
- **Service Account Key**: Ensure `a.json` is valid and has Firestore permissions.
- **Destructive Operations**: `import.js` deletes collections/documents not present in the input JSON. Use with caution.
- **Empty Collections**: `structure.js` omits empty collections for clarity.
- **Error Handling**: Scripts log errors to the console. Check logs if issues arise.
- **Hierarchy**: The scripts preserve Firestoreâ€™s collection-document-subcollection hierarchy.

For issues or contributions, please open an issue or submit a pull request.